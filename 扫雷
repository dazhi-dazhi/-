<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«é›·æ¸¸æˆ</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: url('https://au.9you.com/web_v6/static/wp/100331/1440-900-1.jpg') center/cover;
        }

        table {
            border-collapse: collapse;
            position: relative;
        }

        td {
            width: 20px;
            height: 20px;
            border: 1px solid #ccc;
            text-align: center;
            cursor: pointer;
            background-color: white;
            box-shadow: inset 0 2px 2px rgba(255, 255, 255, 0.5), 0 2px 5px rgba(0, 0, 0, 0.3);
            transform: perspective(1px) translateZ(0);
            transition-duration: 0.3s;
            transition-property: transform;
        }

        td:hover {
            transform: scale(1.05);
        }

        #timer {
            margin-bottom: 10px;
        }

        #instructions {
            margin-top: 20px;
        }

        #game-options {
            display: none;
            flex-direction: row;
            gap: 10px;
        }

        #max-level-container {
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #difficulty-container {
            margin-top: 10px;
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .difficulty {
            width: 20px;
            height: 20px;
            background-color: lightblue;
            text-align: center;
            line-height: 20px;
            cursor: pointer;
        }

        .difficulty:hover {
            background-color: lightgreen;
        }

        #game-options button {
            background-color: hsl(45, 40%, 80%);
            box-shadow: inset 0 2px 2px rgba(255, 255, 255, 0.5), 0 2px 5px rgba(0, 0, 0, 0.3);
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            transition-duration: 0.3s;
            transition-property: transform;
        }

        #game-options button:hover {
            transform: scale(1.05);
        }

        #game-success {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            color: red;
            z-index: 1;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
        }

        #submit-button {
            background-color: hsl(45, 40%, 80%);
            box-shadow: inset 0 2px 2px rgba(255, 255, 255, 0.5), 0 2px 5px rgba(0, 0, 0, 0.3);
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            transition-duration: 0.3s;
            transition-property: transform;
        }

        #submit-button:hover {
            transform: scale(1.05);
        }

        #result-message {
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div id="max-level-container">
        <div>
            <h1>æ‰«é›·æ¸¸æˆ</h1>
            <div id="timer">æ—¶é—´: 0 ç§’</div>
            <div id="difficulty-container">
                <span>éš¾åº¦ç³»æ•°é€‰æ‹©</span>
                <!-- éš¾åº¦ç³»æ•°é€‰æ‹© -->
            </div>
            <div id="game-options">
                <button id="option1">å†æ¥ä¸€æ¬¡</button>
                <button id="option2">è¿›å…¥ä¸‹ä¸€å…³</button>
            </div>
            <button id="submit-button">æäº¤</button>
            <div id="result-message"></div>
            <table id="board"></table>
            <div id="game-success">æ¸¸æˆæˆåŠŸ</div>
            <div id="instructions">
                <p>æ¸¸æˆæç¤ºï¼šæ•°å­—ä»£è¡¨å‘¨å›´åœ°é›·çš„æ•°é‡</p>
            </div>
        </div>
    </div>
    <audio id="background-music" autoplay loop>
        <source src="https://api.doubao.com/random-music" type="audio/mpeg">
        ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
    </audio>
    <audio id="explosion-sound">
        <source src="https://www.soundjay.com/explosion/explosion-01.wav" type="audio/wav">
        ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
    </audio>
    <script>
        let currentDifficulty = 1;
        let rows, cols, mines;
        const board = document.getElementById('board');
        const cells = [];
        const mineLocations = [];
        let timerInterval;
        let elapsedTime = 0;
        const gameOptions = document.getElementById('game-options');
        const option1 = document.getElementById('option1');
        const option2 = document.getElementById('option2');
        const backgroundMusic = document.getElementById('background-music');
        const explosionSound = document.getElementById('explosion-sound');
        const difficultyContainer = document.getElementById('difficulty-container');
        const gameSuccess = document.getElementById('game-success');
        const submitButton = document.getElementById('submit-button');
        const resultMessage = document.getElementById('result-message');

        // åˆå§‹åŒ–éš¾åº¦ç³»æ•°é€‰æ‹©
        function initDifficultySelection() {
            for (let i = 1; i <= 10; i++) {
                const difficultyDiv = document.createElement('div');
                difficultyDiv.classList.add('difficulty');
                difficultyDiv.textContent = i;
                difficultyDiv.addEventListener('click', () => {
                    currentDifficulty = i;
                    initBoard();
                });
                difficultyContainer.appendChild(difficultyDiv);
            }
        }

        // åˆå§‹åŒ–ä¸åŒéš¾åº¦çš„å‚æ•°
        function getDifficultyParams(difficulty) {
            if (difficulty === 1) {
                rows = 8;
                cols = 8;
                mines = 4;
            } else if (difficulty <= 3) {
                rows = 8 + (difficulty - 1) * 2;
                cols = 8 + (difficulty - 1) * 2;
                mines = 4 + (difficulty - 1) * 3;
            } else if (difficulty <= 6) {
                rows = 14 + (difficulty - 4) * 2;
                cols = 14 + (difficulty - 4) * 2;
                mines = 10 + (difficulty - 4) * 5;
            } else {
                rows = 20 + (difficulty - 7) * 2;
                cols = 20 + (difficulty - 7) * 2;
                mines = 25 + (difficulty - 7) * 8;
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆæ¿
        function initBoard() {
            board.innerHTML = '';
            cells.length = 0;
            mineLocations.length = 0;
            getDifficultyParams(currentDifficulty);
            for (let i = 0; i < rows; i++) {
                const row = document.createElement('tr');
                cells[i] = [];
                for (let j = 0; j < cols; j++) {
                    const cell = document.createElement('td');
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.addEventListener('click', () => handleClick(i, j));
                    row.appendChild(cell);
                    cells[i][j] = cell;
                }
                board.appendChild(row);
            }
            placeMines();
            calculateNumbers();
            startTimer();
            gameOptions.style.display = 'none';
            gameSuccess.style.display = 'none';
            submitButton.style.display = 'block';
            resultMessage.textContent = '';
            // éšè—é€æ˜åº¦æ˜¾ç¤ºçš„åœ°é›·
            mineLocations.forEach(([row, col]) => {
                cells[row][col].textContent = '';
                cells[row][col].style.opacity = 1;
            });
        }

        // æ”¾ç½®åœ°é›·
        function placeMines() {
            let count = 0;
            while (count < mines) {
                const row = Math.floor(Math.random() * rows);
                const col = Math.floor(Math.random() * cols);
                if (!mineLocations.some(mine => mine[0] === row && mine[1] === col)) {
                    mineLocations.push([row, col]);
                    count++;
                }
            }
        }

        // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°é‡
        function calculateNumbers() {
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    let mineCount = 0;
                    for (let x = Math.max(i - 1, 0); x <= Math.min(i + 1, rows - 1); x++) {
                        for (let y = Math.max(j - 1, 0); y <= Math.min(j + 1, cols - 1); y++) {
                            if (mineLocations.some(mine => mine[0] === x && mine[1] === y)) {
                                mineCount++;
                            }
                        }
                    }
                    // é™åˆ¶æœ€å¤§æ•°å­—ä¸º4
                    cells[i][j].dataset.mines = Math.min(mineCount, 4);
                }
            }
        }

        // å¤„ç†ç‚¹å‡»äº‹ä»¶
        function handleClick(row, col) {
            const cell = cells[row][col];
            if (mineLocations.some(mine => mine[0] === row && mine[1] === col)) {
                // è¸©åˆ°åœ°é›·ï¼Œæ˜¾ç¤ºç‚¸å¼¹ï¼Œæ¸¸æˆç»“æŸ
                cell.textContent = 'ğŸ’£';
                stopTimer();
                explosionSound.play();
                alert('æ¸¸æˆç»“æŸï¼Œä½ è¸©åˆ°åœ°é›·äº†ï¼');
                revealAllMines();
                showGameOptions(false);
                submitButton.style.display = 'none';
            } else {
                const mineCount = parseInt(cell.dataset.mines);
                if (mineCount > 0) {
                    cell.textContent = mineCount;
                } else {
                    // é€’å½’å±•å¼€ç©ºç™½åŒºåŸŸ
                    floodFill(row, col);
                }
                checkWin();
            }
        }

        // é€’å½’å±•å¼€ç©ºç™½åŒºåŸŸ
        function floodFill(row, col) {
            if (row < 0 || row >= rows || col < 0 || col >= cols) return;
            const cell = cells[row][col];
            if (cell.textContent || cell.style.backgroundColor === 'lightgray') return;
            const mineCount = parseInt(cell.dataset.mines);
            cell.textContent = mineCount > 0 ? mineCount : '';
            cell.style.backgroundColor = 'lightgray';
            if (mineCount === 0) {
                for (let x = Math.max(row - 1, 0); x <= Math.min(row + 1, rows - 1); x++) {
                    for (let y = Math.max(col - 1, 0); y <= Math.min(col + 1, cols - 1); y++) {
                        floodFill(x, y);
                    }
                }
            }
        }

        // æ­ç¤ºæ‰€æœ‰åœ°é›·
        function revealAllMines() {
            mineLocations.forEach(([row, col]) => {
                cells[row][col].textContent = 'ğŸ’£';
            });
        }

        // æ£€æŸ¥æ˜¯å¦è·èƒœ
        function checkWin() {
            let unrevealedNonMineCells = 0;
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    if (!mineLocations.some(mine => mine[0] === i && mine[1] === j) && (!cells[i][j].textContent || cells[i][j].style.backgroundColor!== 'lightgray')) {
                        unrevealedNonMineCells++;
                    }
                }
            }
            if (unrevealedNonMineCells === 0) {
                console.log('æ¸¸æˆæˆåŠŸæ¡ä»¶æ»¡è¶³');
                stopTimer();
                gameSuccess.style.display = 'block';
                showGameOptions(true);
                submitButton.style.display = 'none';
            }
        }

        // æäº¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        function onSubmitClick() {
            mineLocations.forEach(([row, col]) => {
                cells[row][col].textContent = 'ğŸ’£';
                cells[row][col].style.opacity = 0.5;
            });
            let allFilled = true;
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const cell = cells[i][j];
                    if (!cell.textContent && cell.style.backgroundColor!== 'lightgray') {
                        allFilled = false;
                        break;
                    }
                }
                if (!allFilled) break;
            }
            if (allFilled) {
                resultMessage.textContent = 'æ¸¸æˆæˆåŠŸ';
                stopTimer();
                gameSuccess.style.display = 'block';
            } else {
                resultMessage.textContent = 'è¿˜æœ‰æ²¡é€‰åˆ°çš„æ ¼å­';
            }
            submitButton.style.display = 'none';
            showGameOptions(true);
        }

        // æ˜¾ç¤ºæ¸¸æˆé€‰é¡¹
        function showGameOptions(isWin) {
            console.log('æ˜¾ç¤ºæ¸¸æˆé€‰é¡¹ï¼ŒisWin:', isWin);
            gameOptions.style.display = 'flex';
            option1.textContent = 'å†æ¥ä¸€æ¬¡';
            option2.textContent = 'è¿›å…¥ä¸‹ä¸€å…³';
            option1.onclick = () => {
                initBoard();
            };
            option2.onclick = () => {
                if (currentDifficulty < 10) {
                    currentDifficulty++;
                    initBoard();
                } else {
                    alert('å·²ç»æ˜¯æœ€é«˜éš¾åº¦å•¦ï¼');
                }
            };
        }

        // å¯åŠ¨è®¡æ—¶å™¨
        function startTimer() {
            elapsedTime = 0;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                elapsedTime++;
                document.getElementById('timer').textContent = `æ—¶é—´: ${elapsedTime} ç§’`;
            }, 1000);
            backgroundMusic.play();
            submitButton.style.display = 'block';
        }

        // åœæ­¢è®¡æ—¶å™¨
        function stopTimer() {
            clearInterval(timerInterval);
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;
        }

        initDifficultySelection();
        initBoard();
        submitButton.addEventListener('click', onSubmitClick);
    </script>
</body>

</html>
